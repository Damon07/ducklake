# name: test/sql/ducklake_filter_pushdown.test
# description: Test filter pushdown into DuckLake files
# group: [ducklake]

require ducklake

require parquet

statement ok
ATTACH 'ducklake:__TEST_DIR__/ducklake_filter_pushdown.db' AS ducklake (DATA_PATH '__TEST_DIR__/ducklake_filter_pushdown_files')

statement ok
CREATE TABLE ducklake.filter_pushdown(i INTEGER, d DATE, k DECIMAL(9, 3), s VARCHAR);

# file 1 -
# i: 0..1000
# d: 2000-01-01 - 2000-02-11
# k: 0..100
# s: 000000...000999
statement ok
INSERT INTO ducklake.filter_pushdown
SELECT i, (TIMESTAMP '2000-01-01' + interval (i) hour)::DATE, i / 10, printf('%06d', i)
FROM range(1000) t(i)

# file 2 -
# i: 500000..501000
# d: 2027-01-15 - 2027-02-25
# k: 50000..50100
# s: 500000...500999
statement ok
INSERT INTO ducklake.filter_pushdown
SELECT i, (TIMESTAMP '2000-01-01' + interval (i) hour)::DATE, i / 10, printf('%06d', i)
FROM range(100000,101000) t(i)

statement ok
INSERT INTO ducklake.filter_pushdown
SELECT i, (TIMESTAMP '1970-01-01' + interval (i) hour)::DATE, i / 10, printf('%06d', i)
FROM range(500000,501000) t(i)

query IIII
SELECT * FROM ducklake.filter_pushdown WHERE i=527
----
527	2000-01-22	52.700	000527
