# name: test/sql/ducklake_view.test
# description: test ducklake view creation
# group: [ducklake]

require ducklake

require parquet

statement ok
ATTACH 'ducklake:__TEST_DIR__/ducklake_view.db' AS ducklake (DATA_PATH '__TEST_DIR__/ducklake_view_files')

# create a viedw
statement ok
CREATE VIEW ducklake.v1 AS SELECT 42

query I
SELECT * FROM ducklake.v1
----
42

# tables and views cannot share the same name
statement error
CREATE TABLE ducklake.v1 AS SELECT 84
----
already exists

# we can drop the view
statement ok
DROP VIEW ducklake.v1

# aaaand it's gone
statement error
SELECT * FROM ducklake.v1
----
not exists

# conflict creating a view with the same name
statement ok
BEGIN

statement ok
CREATE VIEW ducklake.v1 AS SELECT 42

statement error
CREATE VIEW ducklake.v1 AS SELECT 84
----
already exists

statement ok
ROLLBACK

# conflict creating a view with the same name as a table
statement ok
BEGIN

statement ok
CREATE TABLE ducklake.t1 AS SELECT 42

statement error
CREATE VIEW ducklake.t1 AS SELECT 84
----
already exists

statement ok
ROLLBACK




statement ok
CREATE TABLE ducklake.test(i INTEGER, j INTEGER);

statement ok
INSERT INTO ducklake.test VALUES (1, 2), (NULL, 3);

query II
SELECT * FROM ducklake.test
----
1	2
NULL	3
