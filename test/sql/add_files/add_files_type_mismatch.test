# name: test/sql/add_files/add_files_type_mismatch.test
# description: test ducklake adding files with different types
# group: [add_files]

require ducklake

require parquet

statement ok
ATTACH 'ducklake:__TEST_DIR__/ducklake_add_files_type_mismatch.db' AS ducklake

# unsigned types
foreach UNSIGNED_TYPE UTINYINT USMALLINT UINTEGER UBIGINT

statement ok
CREATE TABLE ducklake.test(col1 ${UNSIGNED_TYPE});

statement ok
COPY (SELECT -1::INTEGER col1) TO '__TEST_DIR__/unsigned_type_mismatch.parquet'

statement error
CALL ducklake_add_data_files('ducklake', 'test', '__TEST_DIR__/unsigned_type_mismatch.parquet')
----
Converted Type "INT_32" is not accepted

statement ok
COPY (SELECT 42::${UNSIGNED_TYPE} col1) TO '__TEST_DIR__/unsigned_type.parquet'

statement ok
CALL ducklake_add_data_files('ducklake', 'test', '__TEST_DIR__/unsigned_type.parquet')

query I
FROM ducklake.test
----
42

statement ok
DROP TABLE ducklake.test

endloop
