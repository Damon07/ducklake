# name: test/sql/ducklake_time_travel_views.test
# description: test time travel of views in ducklake
# group: [ducklake]

require ducklake

require parquet

statement ok
ATTACH 'ducklake:__TEST_DIR__/ducklake_time_travel_views.db' AS ducklake (DATA_PATH '__TEST_DIR__/ducklake_time_travel_views_files')

statement ok
CREATE TABLE ducklake.test(i INTEGER, j INTEGER);

statement ok
CREATE VIEW ducklake.v1 AS SELECT i * 100 AS i, j * 100 AS j FROM test ORDER BY ALL

statement ok
INSERT INTO ducklake.test VALUES (1, 2), (2, 3);

statement ok
INSERT INTO ducklake.test VALUES (3, 4), (5, 6);

query II
SELECT * FROM ducklake.v1
----
100	200
200	300
300	400
500	600

# view does not exist
statement error
SELECT * FROM ducklake.v1 AT (VERSION => 0)
----
does not exist at version 0

query II
SELECT * FROM ducklake.v1 AT (VERSION => 2)
----

query II
SELECT * FROM ducklake.v1 AT (VERSION => 3)
----
100	200
200	300

query II
SELECT * FROM ducklake.v1 AT (VERSION => 4)
----
100	200
200	300
300	400
500	600

# now time travel
