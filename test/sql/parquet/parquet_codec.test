# name: test/sql/parquet/parquet_codec.test
# description: Test parquet codec
# group: [parquet]

require ducklake

require parquet

statement ok
ATTACH 'ducklake:__TEST_DIR__/ducklake_parquet_codec.db' AS ducklake (DATA_PATH '__TEST_DIR__/ducklake_parquet_codec')

statement ok
CALL ducklake.set_option('parquet_compression', 'zstd')

statement ok
CREATE TABLE ducklake.tbl AS SELECT 42 i

query I
SELECT DISTINCT compression FROM parquet_metadata('__TEST_DIR__/ducklake_parquet_codec/**')
----
ZSTD

# ensure setting persists across restarts
statement ok
DETACH ducklake

statement ok
ATTACH 'ducklake:__TEST_DIR__/ducklake_parquet_codec.db' AS ducklake (DATA_PATH '__TEST_DIR__/ducklake_parquet_codec')

statement ok
INSERT INTO ducklake.tbl VALUES (42);

query I
SELECT DISTINCT compression FROM parquet_metadata('__TEST_DIR__/ducklake_parquet_codec/**')
----
ZSTD
